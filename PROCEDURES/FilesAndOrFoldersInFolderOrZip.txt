
Function FilesAndOrFoldersInFolderOrZip(ByVal FolderOrZipFilePath As Variant, LogFolders As Boolean, LogFiles As Boolean, ScanInSubfolders As Boolean, out As Collection, Optional Filter As String = "*")
    Dim osh As New Shell
    Dim oFi As Object
    For Each oFi In osh.Namespace(FolderOrZipFilePath).Items
        If oFi.IsFolder Then
            If LogFolders Then
                out.Add oFi.Path & "\"
            End If
            If ScanInSubfolders Then FilesAndOrFoldersInFolderOrZip oFi.Path, LogFolders, LogFiles, ScanInSubfolders, out, Filter
        Else
            If LogFiles Then
                If UCase(oFi.Name) Like UCase(Filter) Then
                    out.Add oFi.Path
                End If
            End If
        End If
    Next
    Set FilesAndOrFoldersInFolderOrZip = out
    Set osh = Nothing
End Function
