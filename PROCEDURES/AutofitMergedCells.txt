
Sub AutofitMergedCells(TargetRange As Range)
    Dim mw As Single
    Dim cm As Range
    Dim rng As Range
    Dim CW As Double
    Dim rwht As Double
    Dim Ar As Variant
    Dim i As Integer
    StartOptimizeCodeRun
    Dim cell As Range
    Dim TimeStarted
    TimeStarted = Now()
    For Each cell In TargetRange
        If cell.MergeCells = True Then
            Set rng = Range(cell.MergeArea.Address)
            rng.MergeCells = False
            CW = rng.Cells(1).ColumnWidth
            mw = 0
            For Each cm In rng
                cm.WrapText = True
                mw = cm.ColumnWidth + mw
            Next
            mw = mw + rng.Cells.Count * 0.66
            rng.Cells(1).ColumnWidth = mw
            rng.EntireRow.AutoFit
            rwht = rng.RowHeight
            rng.Cells(1).ColumnWidth = CW
            rng.MergeCells = True
            rng.RowHeight = rwht
        End If
        If Now > TimeStarted + TimeSerial(0, 1, 0) Then Stop
    Next
    StopOptimizeCodeRun
End Sub
