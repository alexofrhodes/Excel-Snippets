
Public Function RegexAllMatches(ByVal sInput As Variant, sPattern As String) As Variant
    On Error GoTo Error_Handler
    Dim oRegEx                As Object

    Dim oMatches              As Object
    Dim oMatch                As Object
    Dim sMatch                As String
    If Not IsNull(sInput) Then
        Set oRegEx = CreateObject("vbscript.regexp")
        With oRegEx
            .pattern = sPattern
            .Global = True
            .IgnoreCase = True
            .MultiLine = True
            Set oMatches = .Execute(sInput)
        End With
        For Each oMatch In oMatches
            sMatch = oMatch.Value & "," & sMatch
        Next oMatch
        If Right(sMatch, 1) = "," Then sMatch = Left(sMatch, Len(sMatch) - 1)
        RegexAllMatches = Split(sMatch, ",")
    Else
        RegexAllMatches = Null
    End If
Error_Handler_Exit:
    On Error Resume Next
    If Not oMatch Is Nothing Then Set oMatch = Nothing
    If Not oMatches Is Nothing Then Set oMatches = Nothing
    If Not oRegEx Is Nothing Then Set oRegEx = Nothing
    Exit Function
Error_Handler:
    MsgBox "The following error has occured" & vbCrLf & vbCrLf & _
    "Error Number: " & Err.Number & vbCrLf & _
    "Error Source: RegexAllMatches" & vbCrLf & _
    "Error Description: " & Err.Description & _
    Switch(Erl = 0, "", Erl <> 0, vbCrLf & "Line No: " & Erl) _
    , vbOKOnly + vbCritical, "An Error has Occured!"
    Resume Error_Handler_Exit
End Function
