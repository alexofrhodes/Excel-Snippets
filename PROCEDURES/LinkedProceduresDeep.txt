
Function LinkedProceduresDeep( _
                             ProcedureName As Variant, _
                             TargetWorkbook As Workbook) As Collection
'@BlogPosted
'@AssignedModule F_VbeLinkedProcedures
'@INCLUDE PROCEDURE CollectionSort
'@INCLUDE PROCEDURE CollectionContains
'@INCLUDE PROCEDURE ProceduresOfWorkbook
'@INCLUDE PROCEDURE ModuleOfProcedure
'@INCLUDE PROCEDURE AddProcedureCallsToCollection
    
    Dim AllProcedures As Collection:       Set AllProcedures = ProceduresOfWorkbook(TargetWorkbook)
    Dim Processed As Collection:           Set Processed = New Collection
    Dim CalledProcedures As Collection:    Set CalledProcedures = New Collection

    AddProcedureCallsToCollection _
                        TargetWorkbook:=TargetWorkbook, _
                        Module:=ModuleOfProcedure(TargetWorkbook, ProcedureName), _
                        ProcedureName:=ProcedureName, _
                        AllProcedures:=AllProcedures, _
                        OutputCollection:=CalledProcedures
                        
    Dim CalledProceduresCount As Long:    CalledProceduresCount = CalledProcedures.Count
    Dim Procedure As Variant
    Dim Module As VBComponent
repeat:
    For Each Procedure In CalledProcedures
        If Not CollectionContains(Processed, , CStr(Procedure)) Then
            Processed.Add Procedure, CStr(Procedure)
            Set Module = ModuleOfProcedure(TargetWorkbook, ProcedureName)
            AddProcedureCallsToCollection TargetWorkbook, Module, CStr(Procedure), AllProcedures, CalledProcedures
        End If
    Next
    If CalledProcedures.Count > CalledProceduresCount Then
        CalledProceduresCount = CalledProcedures.Count
        GoTo repeat
    End If

    Set LinkedProceduresDeep = CollectionSort(CalledProcedures)
End Function
