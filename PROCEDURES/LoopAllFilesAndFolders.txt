
Public Sub LoopAllFilesAndFolders(FolderPath As String)
    If Right(FolderPath, 1) <> "\" Then FolderPath = FolderPath & "\"
    Dim objFSO As Scripting.FileSystemObject
    Set objFSO = CreateObject("Scripting.FileSystemObject")
    Dim objFile As Scripting.File
    Dim objFolder As Scripting.Folder
    Dim objTopFolder As Scripting.Folder
    Set objTopFolder = objFSO.getFolder(FolderPath)
    For Each objFile In objFolder.Files
        Rem code here
    Next
    Dim objSubFolder As Scripting.Folder
    For Each objSubFolder In objFolder.SubFolders
        LoopAllFilesAndFolders objSubFolder.Path
    Next
End Sub
