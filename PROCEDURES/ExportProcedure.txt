


Sub ExportProcedure( _
                    Optional TargetWorkbook As Workbook, _
                    Optional Module As VBComponent, _
                    Optional ProcedureName As String)
'@BlogPosted
'@AssignedModule F_Vbe_Procedures_Export
'@INCLUDE PROCEDURE TxtOverwrite
'@INCLUDE PROCEDURE TxtRead
'@INCLUDE PROCEDURE FollowLink
'@INCLUDE PROCEDURE AssignCPSvariables
'@INCLUDE PROCEDURE LinkedProceduresDeep
'@INCLUDE PROCEDURE ProcedureCode
'@INCLUDE PROCEDURE ProjetFoldersCreate
'@INCLUDE PROCEDURE TxtPrependContainedProcedures
'@INCLUDE PROCEDURE ExportTargetProcedure
'@INCLUDE DECLARATION GITHUB_LOCAL_LIBRARY_PROCEDURES

    If Not AssignCPSvariables(TargetWorkbook, Module, ProcedureName) Then Exit Sub

    ProjetFoldersCreate

    Dim ExportedProcedures As New Collection
    On Error GoTo ErrorHandler

    ExportedProcedures.Add CStr(ProcedureName), CStr(ProcedureName)

    Dim Procedure
    For Each Procedure In LinkedProceduresDeep(ProcedureName, TargetWorkbook)
        ExportedProcedures.Add CStr(Procedure), CStr(Procedure)
    Next

    Dim ProceduresCount As Long
        ProceduresCount = ExportedProcedures.Count

    If ExportedProcedures.Count > 1 Then

        For Each Procedure In ExportedProcedures
            ExportTargetProcedure TargetWorkbook, , CStr(Procedure)
        Next

        Dim MergedName As String
            MergedName = "Merged_" & ProcedureName
        Dim procFile As String
        Dim MergedString As String

        For Each Procedure In ExportedProcedures
            procFile = GITHUB_LOCAL_LIBRARY_PROCEDURES & CStr(Procedure) & ".txt"
'            MergedString = IIf(MergedString = "", TxtRead(procFile), MergedString & vbNewLine & TxtRead(procFile))
            MergedString = MergedString & vbNewLine & ProcedureCode(TargetWorkbook, , Procedure)
        Next
        
        TxtOverwrite GITHUB_LOCAL_LIBRARY_PROCEDURES & MergedName & ".txt", MergedString
        Debug.Print "OVERWROTE " & MergedName
        TxtPrependContainedProcedures GITHUB_LOCAL_LIBRARY_PROCEDURES & MergedName & ".txt"
        
    End If

    FollowLink GITHUB_LOCAL_LIBRARY_PROCEDURES
    
    Exit Sub
ErrorHandler:
    MsgBox "An error occured in Sub ExportProcedure"
End Sub
