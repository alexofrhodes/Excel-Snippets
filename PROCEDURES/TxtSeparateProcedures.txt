
Sub TxtSeparateProcedures(FilePath As Variant, Optional OutputFolder As String)

'@AssignedModule F_FileFolder
'@INCLUDE PROCEDURE TxtOverwrite
'@INCLUDE PROCEDURE TxtRead
    Dim fname As String
    If OutputFolder = "" Then
        OutputFolder = Left(FilePath, InStrRev(FilePath, "\"))
    Else
        FoldersCreate OutputFolder
    End If
    Dim Code As Variant
        Code = Split(TxtRead(FilePath), vbLf)
    Dim out As String
    Dim i As Long
    For i = LBound(Code) To UBound(Code)

        out = IIf(out = "", Code(i), out & Code(i)) & vbNewLine
        If RegexTest(Code(i), "Sub ") _
        And Not Code(i) Like Chr(34) & "*Sub*" Then
            fname = Split(Code(i), "Sub ")(1)
            fname = Trim(Split(fname, "(")(0)) & ".txt"
        ElseIf RegexTest(Code(i), "Function ") _
        And Not Code(i) Like Chr(34) & "*Function*" Then
            fname = Split(Code(i), "Function ")(1)
            fname = Trim(Split(fname, "(")(0)) & ".txt"
        End If
        If Trim(Code(i)) = "End Sub" Or Trim(Code(i)) = "End Function" Then
            TxtOverwrite OutputFolder & fname, out
            out = ""
            fname = ""
        End If
    Next

End Sub
